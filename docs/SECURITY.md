# Security Guide - Environment Variables

## üîê Understanding Local vs Production Keys

This project uses different Supabase keys for local development and production. It's crucial to understand which are safe to commit and which are not.

## ‚úÖ SAFE to Commit (Local Development Keys)

### File: `.env.local.development`

```bash
NEXT_PUBLIC_SUPABASE_URL=http://127.0.0.1:54321
NEXT_PUBLIC_SUPABASE_ANON_KEY=sb_publishable_ACJWlzQHlZjBrEguHvfOxg_3BJgxAaH
SUPABASE_SERVICE_ROLE_KEY=sb_secret_N7UND0UgjKTVK-Uodkm0Hg_xSvEMPvz
```

### Why These Are Safe

1. **Localhost Only**
   - URL is `http://127.0.0.1:54321` (your computer only)
   - Cannot be accessed from the internet
   - Only works when Supabase is running locally (`npm run supabase:start`)

2. **Standard Generated Keys**
   - These are NOT unique to your project
   - Every developer running `supabase start` gets the same keys
   - They're generated by the Supabase CLI, not by Supabase cloud
   - You can see them in [Supabase's own documentation](https://supabase.com/docs/guides/cli/local-development)

3. **No Production Access**
   - These keys CANNOT connect to your production database
   - They only work with the local Docker container
   - Production database requires different keys from Supabase cloud

4. **Ephemeral Database**
   - Local database is destroyed when you run `supabase stop`
   - Contains only test/seed data
   - No real user data

### What Can Someone Do With These Keys?

If someone found these keys on GitHub:
- ‚ùå Cannot access your production database
- ‚ùå Cannot access your local database (it's on your machine)
- ‚úÖ They can only use them for their OWN local Supabase instance
- ‚úÖ Which is the intended use case!

**Result: NO SECURITY RISK** ‚úÖ

## ‚ùå NEVER Commit (Production Keys)

### File: `.env.remote` (GITIGNORED)

```bash
# PRODUCTION - NEVER COMMIT!
NEXT_PUBLIC_SUPABASE_URL=https://vckkkupndydwilnzpjkc.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### Why These Are Dangerous

1. **Public Internet Access**
   - URL is `https://your-project.supabase.co` (accessible worldwide)
   - Anyone with the keys can access your database from anywhere

2. **Unique to Your Project**
   - Generated specifically for YOUR Supabase project
   - Provide access to YOUR production data
   - Cannot be changed easily without affecting your application

3. **Service Role Key = Full Access**
   - `SUPABASE_SERVICE_ROLE_KEY` bypasses ALL Row Level Security
   - Can read, modify, or delete ANY data
   - Full administrative access to your database

4. **Real Data at Risk**
   - Production database contains real user data
   - Financial records, personal information, etc.
   - Cannot be "reset" like local database

### What Can Someone Do With These Keys?

If someone found your production keys:
- ‚ö†Ô∏è Read ALL data in your database
- ‚ö†Ô∏è Modify or delete ANY data
- ‚ö†Ô∏è Bypass ALL security policies
- ‚ö†Ô∏è Upload files to your storage
- ‚ö†Ô∏è Impersonate any user
- ‚ö†Ô∏è Potentially cost you money (API usage)

**Result: CRITICAL SECURITY RISK** üö®

## üìÅ File Security Summary

| File | Commit to Git? | Why? |
|------|---------------|------|
| `.env.local.development` | ‚úÖ **YES** | Local-only keys, no risk |
| `.env.local` | ‚ùå **NO** | Contains active credentials |
| `.env.remote` | ‚ùå **NO** | Production credentials |
| `.env.local.backup` | ‚ùå **NO** | Backup of credentials |

## üõ°Ô∏è Protection Mechanisms

### 1. Gitignore Configuration

Our `.gitignore` protects sensitive files:

```gitignore
# env files (can opt-in for committing if needed)
.env.local           # ‚Üê Active environment (never commit)
.env.local.backup    # ‚Üê Backup (never commit)
.env.remote          # ‚Üê Production keys (never commit)
```

**NOT in .gitignore:**
- `.env.local.development` - Intentionally tracked (safe local keys)

### 2. Environment Switcher Safety

The environment switcher (`npm run env:local` / `npm run env:remote`) helps by:
- Keeping active credentials in `.env.local` (gitignored)
- Maintaining separate templates for local and remote
- Creating automatic backups before switching

### 3. Documentation

Clear comments in `.env.local.development` explain why it's safe to commit.

## üîç How to Verify Security

### Check What's Tracked in Git

```bash
# See which env files are committed
git ls-files | grep env

# Should only show:
# .env.local.development
```

### Check What's Ignored

```bash
# See what git is ignoring
git status --ignored | grep env

# Should show:
# .env.local
# .env.local.backup
# .env.remote
```

### Verify No Secrets in History

```bash
# Check git history for sensitive files
git log --all --full-history -- .env.remote
git log --all --full-history -- .env.local

# Should return nothing (these files should never have been committed)
```

## üö® What If I Accidentally Committed Production Keys?

If you accidentally committed `.env.remote` or production keys:

### Immediate Actions

1. **Rotate Your Keys Immediately**
   - Go to Supabase Dashboard ‚Üí Project Settings ‚Üí API
   - Generate new Service Role Key
   - Update `.env.remote` locally

2. **Remove from Git History**
   ```bash
   # Use BFG Repo Cleaner or git filter-branch
   # This is complex - consider making keys invalid instead
   ```

3. **Force Push (if repository is private and you're the only user)**
   ```bash
   # DANGER: Only if absolutely necessary
   git push --force
   ```

4. **Monitor for Suspicious Activity**
   - Check Supabase Dashboard for unusual queries
   - Review audit logs
   - Monitor your database

### Prevention

- Always run `git status` before `git commit`
- Use a pre-commit hook to check for sensitive files
- Never manually edit `.env.local` - use the environment switcher
- Keep `.env.remote` updated only when credentials change

## üìö Official Supabase Guidance

From [Supabase Documentation](https://supabase.com/docs/guides/cli/local-development):

> "The local development keys are safe to commit to version control. They only work with your local Supabase instance and provide no access to your production database."

This is an **official best practice** from Supabase.

## ‚úÖ Best Practices Summary

1. **Commit `.env.local.development`** ‚úÖ
   - Contains local-only keys
   - Helps team onboarding
   - Official Supabase recommendation

2. **Never commit `.env.remote`** ‚ùå
   - Contains production secrets
   - Critical security risk
   - Already gitignored

3. **Use environment switcher**
   - `npm run env:local` / `npm run env:remote`
   - Manages credentials safely
   - Prevents manual errors

4. **Regularly audit commits**
   ```bash
   # Before pushing
   git diff --cached | grep -i "supabase_service_role_key"
   ```

5. **Keep production keys secure**
   - Only share via secure channels (1Password, etc.)
   - Rotate periodically
   - Limit who has access

## üîó Further Reading

- [Supabase CLI Local Development](https://supabase.com/docs/guides/cli/local-development)
- [Supabase Security Best Practices](https://supabase.com/docs/guides/platform/security)
- [Managing Environment Variables](https://nextjs.org/docs/app/building-your-application/configuring/environment-variables)

## Summary

**Local Development Keys** (`.env.local.development`):
- ‚úÖ Safe to commit
- ‚úÖ Public knowledge (standard Supabase CLI keys)
- ‚úÖ Only work on localhost
- ‚úÖ Best practice per Supabase documentation

**Production Keys** (`.env.remote`):
- ‚ùå NEVER commit
- ‚ùå Provide full database access
- ‚ùå Work from anywhere
- ‚ùå Critical security risk if exposed

**When in doubt: Don't commit!** You can always add a file later, but removing secrets from git history is difficult.
